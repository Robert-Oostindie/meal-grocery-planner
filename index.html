<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Grocery Planner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
    <style>
      /* Minimal FAB styling to work with your existing theme */
      .fab {
        position: fixed;
        right: 18px;
        bottom: 80px;
        width: 52px;
        height: 52px;
        border-radius: 999px;
        border: none;
        background: #f9fafb;
        box-shadow: 0 12px 28px rgba(15, 23, 42, 0.35);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        color: #111827;
        cursor: pointer;
        z-index: 60;
      }
      .fab span {
        margin-top: -2px;
      }
      @media (prefers-color-scheme: dark) {
        .fab {
          background: #020617;
          color: #e5e7eb;
          box-shadow: 0 18px 40px rgba(0, 0, 0, 0.7);
        }
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <!-- HEADER -->
      <header>
        <div class="app-title">
          Grocery Planner
          <span class="sub">Meals ‚Ä¢ Planner ‚Ä¢ Stores ‚Ä¢ List</span>
        </div>
        <div class="pill">Weekly Grocery Assistant</div>
      </header>

      <!-- MAIN CONTENT -->
      <main>
        <!-- RECIPES TAB (MEALS) -->
        <section id="tab-meals">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Add a Recipe</div>
                <div class="card-subtitle">
                  Save meals with ingredients and categories.
                </div>
              </div>
              <span id="meal-count-badge" class="badge">0 meals</span>
            </div>

            <div class="mt-4">
              <label for="meal-name">Recipe name</label>
              <input
                id="meal-name"
                type="text"
                placeholder="e.g. Burrito Bowl, Pancakes"
              />
            </div>

            <div class="mt-4">
              <label for="meal-category">Category (optional)</label>
              <select id="meal-category"></select>
              <div class="inline-note">
                Examples: Low Prep, Medium Prep, Crock Pot, Grilling, Breakfast,
                Sides, Appetizers, Baby Meals.
              </div>
            </div>

            <div class="mt-4">
              <label for="meal-notes">Notes (optional)</label>
              <textarea
                id="meal-notes"
                placeholder="Any extra notes, tips, or links for this recipe..."
              ></textarea>
            </div>

            <div class="mt-8">
              <button id="add-meal-btn" class="btn btn-primary">
                <span>Ôºã</span> Save Recipe
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">Saved Recipes</div>
              <div class="card-subtitle">
                Edit ingredients, categories, and default substitutes.
              </div>
            </div>

            <div id="meals-empty-state" class="section-note">
              No recipes yet. Start by adding your first meal above.
            </div>

            <div id="meal-list" class="meal-list"></div>
          </div>
        </section>

        <!-- PLANNER TAB -->
        <section id="tab-planner" class="hidden">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Weekly Planner</div>
                <div class="card-subtitle">
                  Choose recipes for this week and adjust ingredients.
                </div>
              </div>
            </div>

            <div id="planner-empty" class="section-note">
              No recipes yet. Add some recipes first on the Recipes tab.
            </div>

            <div id="planner-meals"></div>

            <div class="mt-8">
              <button id="generate-list-btn" class="btn btn-primary">
                Generate Grocery List
              </button>
              <div class="inline-note">
                Uses your selected meals, ingredient toggles, comments, pantry,
                and extras.
              </div>
            </div>
          </div>
        </section>

        <!-- PANTRY TAB (no top tab; reached from Other) -->
        <section id="tab-pantry" class="hidden">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Pantry</div>
              <div class="card-subtitle">
                Mark what you already have to keep it off the grocery list.
              </div>
            </div>

            <div class="mt-4">
              <label for="pantry-search">Search ingredients</label>
              <input
                id="pantry-search"
                type="text"
                placeholder="Start typing an ingredient name..."
              />
            </div>

            <div id="pantry-empty" class="section-note mt-4">
              No ingredients yet. Add ingredients to your recipes first.
            </div>

            <div id="pantry-list"></div>
          </div>
        </section>

        <!-- STORES TAB (no top tab; reached from Other) -->
        <section id="tab-stores" class="hidden">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Stores</div>
              <div class="card-subtitle">
                Manage your store list (Aldi, Walmart, Festival Foods, Woodmans,
                etc.).
              </div>
            </div>

            <div class="mt-4 row">
              <div>
                <label for="store-name">Add a store</label>
                <input
                  id="store-name"
                  type="text"
                  placeholder="e.g. Aldi, Walmart"
                />
              </div>
              <div style="display:flex;align-items:flex-end;">
                <button id="add-store-btn" class="btn btn-outline">
                  Ôºã Add
                </button>
              </div>
            </div>

            <div class="mt-4">
              <div class="section-note">Current stores:</div>
              <div id="store-list" class="tag-list"></div>
            </div>
          </div>

          <div class="card mt-8">
            <div class="card-header">
              <div class="card-title">Backup &amp; Reset</div>
              <div class="card-subtitle">
                Export all your data or reset this browser only.
              </div>
            </div>

            <div class="mt-4 row">
              <button id="export-data-btn" class="btn btn-outline">
                ‚¨á Export Data (JSON)
              </button>
              <button id="reset-app-btn" class="btn btn-danger">
                Reset App
              </button>
            </div>
            <div id="export-status" class="inline-note mt-4"></div>
          </div>
        </section>

        <!-- OTHER TAB (EXTRAS) -->
        <section id="tab-extras" class="hidden">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Other Grocery Items</div>
                <div class="card-subtitle">
                  Add non-meal items like laundry soap, hairspray, snacks.
                </div>
              </div>
            </div>

            <div class="mt-4">
              <label for="extra-name">Item name</label>
              <input
                id="extra-name"
                type="text"
                placeholder="e.g. Laundry soap, Hairspray"
              />
            </div>

            <div class="mt-4 row">
              <div>
                <label for="extra-qty">Quantity (optional)</label>
                <input
                  id="extra-qty"
                  type="number"
                  min="1"
                  placeholder="1"
                />
              </div>
              <div>
                <label for="extra-unit">Unit</label>
                <input
                  id="extra-unit"
                  type="text"
                  value="CT"
                  placeholder="CT, bag, box..."
                />
              </div>
            </div>

            <div class="mt-4">
              <label for="extra-store">Store (optional)</label>
              <select id="extra-store"></select>
            </div>

            <div class="mt-8">
              <button id="add-extra-btn" class="btn btn-primary">
                <span>Ôºã</span> Add Item
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">Other Items for This Week</div>
              <div class="card-subtitle">
                Toggle which extras belong on this week‚Äôs grocery list.
              </div>
            </div>

            <div id="extras-empty" class="section-note">
              No extras yet. Add items above.
            </div>

            <div id="extras-list"></div>
          </div>

          <div class="card mt-8">
            <div class="card-header">
              <div class="card-title">More Tools</div>
              <div class="card-subtitle">
                Quickly access your pantry and store setup.
              </div>
            </div>
            <div class="mt-4 row">
              <button
                class="btn btn-outline"
                onclick="switchTab('pantry')"
              >
                üè† Open Pantry
              </button>
              <button
                class="btn btn-outline"
                onclick="switchTab('stores')"
              >
                üè¨ Manage Stores
              </button>
            </div>
          </div>
        </section>

        <!-- GROCERY LIST TAB -->
        <section id="tab-groceries" class="hidden">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Grocery List</div>
                <div class="card-subtitle">
                  Grouped by store, built from planner, pantry, and extras.
                </div>
              </div>
            </div>

            <div class="mt-4 row">
              <button id="refresh-from-plan-btn" class="btn btn-outline">
                üîÅ Regenerate from Planner
              </button>
              <button id="clear-checks-btn" class="btn btn-outline">
                ‚úñ Clear Checkmarks
              </button>
            </div>

            <div class="mt-4">
              <button id="copy-list-btn" class="btn btn-primary">
                üìã Copy List for iPhone Notes
              </button>
              <div class="inline-note">
                This copies a clean, store-grouped list you can paste into Notes.
              </div>
            </div>

            <div id="grocery-empty" class="section-note mt-6">
              No grocery items yet. Use the Planner tab to generate your list.
            </div>

            <div id="grocery-groups" class="mt-4"></div>
          </div>
        </section>
      </main>

      <!-- FLOATING ACTION BUTTONS -->
      <!-- Recipes FAB -->
      <button
        class="fab"
        id="fab-recipes"
        onclick="document.getElementById('add-meal-btn').click()"
        style="display:none;"
      >
        <span>Ôºã</span>
      </button>

      <!-- Other (Extras) FAB -->
      <button
        class="fab"
        id="fab-extras"
        onclick="document.getElementById('add-extra-btn').click()"
        style="display:none;"
      >
        <span>Ôºã</span>
      </button>

      <!-- BOTTOM TAB BAR -->
      <nav class="tabbar">
        <button class="tab-btn active" data-tab="meals">
          <span class="icon">üìñ</span>
          <span>Recipes</span>
        </button>
        <button class="tab-btn" data-tab="planner">
          <span class="icon">üìÖ</span>
          <span>Planner</span>
        </button>
        <button class="tab-btn" data-tab="extras">
          <span class="icon">‚ûï</span>
          <span>Other</span>
        </button>
        <button class="tab-btn" data-tab="groceries">
          <span class="icon">üõí</span>
          <span>Grocery List</span>
        </button>
      </nav>
    </div>

    <!-- INGREDIENT MODAL -->
    <div id="ingredient-modal" class="modal-backdrop hidden">
      <div class="modal-sheet">
        <div class="modal-handle"></div>
        <div class="modal-header">
          <div class="modal-title" id="ingredient-modal-title">
            Add Ingredient
          </div>
          <button id="ingredient-cancel" class="btn btn-ghost btn-sm">
            ‚úï
          </button>
        </div>

        <div class="mt-4">
          <label for="ingredient-name">Ingredient name</label>
          <input
            id="ingredient-name"
            type="text"
            placeholder="e.g. Chicken thighs, Frozen chicken"
          />
        </div>

        <div class="mt-4 row">
          <div>
            <label for="ingredient-qty">Quantity</label>
            <input
              id="ingredient-qty"
              type="number"
              min="1"
              placeholder="1"
            />
          </div>
          <div>
            <label for="ingredient-unit">Unit</label>
            <input
              id="ingredient-unit"
              type="text"
              value="CT"
              placeholder="CT, lb, bag..."
            />
          </div>
        </div>

        <div class="mt-4">
          <label for="ingredient-store">Store</label>
          <select id="ingredient-store"></select>
        </div>

        <div class="mt-4">
          <label for="ingredient-group">Substitute group (optional)</label>
          <input
            id="ingredient-group"
            list="ingredient-group-suggestions"
            type="text"
            placeholder="e.g. Chicken Option"
          />
          <datalist id="ingredient-group-suggestions"></datalist>
          <div class="inline-note">
            Ingredients with the same group name are substitutes (e.g. fresh vs
            frozen chicken).
          </div>
        </div>

        <div class="mt-4 checkbox-row">
          <input id="ingredient-default" type="checkbox" />
          <span class="muted">
            Make this the default option for its group.
          </span>
        </div>

        <div class="modal-actions">
          <button id="ingredient-cancel-2" class="btn btn-ghost btn-sm">
            Cancel
          </button>
          <button id="ingredient-save" class="btn btn-primary btn-sm">
            Save Ingredient
          </button>
        </div>
      </div>
    </div>

    <!-- SUBSTITUTE SELECTION MODAL -->
    <div id="subs-modal" class="modal-backdrop hidden">
      <div class="modal-sheet">
        <div class="modal-handle"></div>
        <div class="modal-header">
          <div class="modal-title">Choose your ingredient options</div>
          <button id="subs-cancel" class="btn btn-ghost btn-sm">‚úï</button>
        </div>

        <div class="section-note">
          For meals that have multiple options (like fresh vs frozen chicken),
          choose which ingredient you want to use this time.
        </div>

        <div id="subs-modal-body" class="mt-4"></div>

        <div class="modal-actions">
          <button id="subs-cancel-2" class="btn btn-ghost btn-sm">
            Cancel
          </button>
          <button id="subs-apply" class="btn btn-primary btn-sm">
            Apply &amp; Generate List
          </button>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
    <script>
      // Show the correct FAB per tab (Recipes / Other)
      document.addEventListener("DOMContentLoaded", function () {
        const fabRecipes = document.getElementById("fab-recipes");
        const fabExtras = document.getElementById("fab-extras");

        function updateFab(tab) {
          fabRecipes.style.display = tab === "meals" ? "flex" : "none";
          fabExtras.style.display = tab === "extras" ? "flex" : "none";
        }

        // Patch switchTab to also manage FAB visibility, without changing core logic
        const originalSwitchTab = window.switchTab;
        window.switchTab = function (tabName) {
          originalSwitchTab(tabName);
          updateFab(tabName);
        };

        // Initial FAB state
        updateFab("meals");
      });
    </script>
  </body>
</html>
