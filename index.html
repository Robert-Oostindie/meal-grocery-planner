<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Meal Planner</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>

    <!-- TOP NAV TABS -->
    <div class="top-tabs">
        <button class="tab-btn active" data-tab="recipesTab">Recipes</button>
        <button class="tab-btn" data-tab="plannerTab">Planner</button>
        <button class="tab-btn" data-tab="groceryTab">Grocery List</button>
        <button class="tab-btn" data-tab="categoriesTab">Categories</button>
        <button class="tab-btn" data-tab="storesTab">Stores</button>
        <button class="tab-btn" data-tab="otherTab">Other</button>
    </div>

    <!-- MAIN APP CONTAINER -->
    <div class="app-container">

        <!-- RECIPES TAB -->
        <div id="recipesTab" class="tab-page active">
            <h1>Recipes</h1>

            <div class="section-note">
                Add or edit meals. Ingredients & substitutes added in next steps.
            </div>

            <button class="primary add-recipe-btn" onclick="openRecipeModalNew()">
                + Add Recipe
            </button>
            <div style="display:flex; gap:0.5rem; margin-bottom:1rem;">
                <button class="primary" onclick="expandAllRecipeCategories()">Expand All</button>
                <button class="primary" onclick="collapseAllRecipeCategories()">Collapse All</button>
            </div>

            <div id="recipesList"></div>
        </div>

       <!-- PLANNER TAB -->
        <div id="plannerTab" class="tab-page">
            <h1>Planner</h1>
            <p class="section-note">
                Select meals for this trip, then build your grocery list.
            </p>
            <div style="display:flex; gap:0.5rem; margin-bottom:1rem;">
                <button class="primary" onclick="expandAllPlannerCategories()">Expand All</button>
                <button class="primary" onclick="collapseAllPlannerCategories()">Collapse All</button>
            </div>


            <div id="plannerContainer"></div>

            <div class="planner-extras">
                <h3>Other Items</h3>

                <div class="planner-extra-row">
                    <input id="plannerExtraInput" type="text" placeholder="Ex: Laundry Soap">
                    <input id="plannerExtraQty" type="number" value="1" min="1" style="width:70px;">
                    <select id="plannerExtraStore"></select>
                    <button class="primary" onclick="addPlannerExtra()">Add</button>
                </div>

                <div id="plannerExtrasList"></div>
            </div>

            <button class="primary build-grocery-btn" onclick="buildGroceryList()">
                Build Grocery List
            </button>

            <div class="planner-backup-controls" style="margin-top: 1.2rem; display:flex; gap:0.6rem;">
                <button class="primary" onclick="exportAppData()">Export Data</button>
                <button class="primary" onclick="document.getElementById('importFile').click()">Import Data</button>
                <input id="importFile"
                       type="file"
                       accept="application/json"
                       style="display:none"
                       onchange="importAppData(event)">
            </div>
        </div> <!-- END plannerTab -->

        <!-- GROCERY TAB -->
       <div id="groceryTab" class="tab-page">
            <h1>Grocery List</h1>
            <p class="section-note">
                Based on your selected meals and other items.
            </p>
            <div id="groceryContainer"></div>
        </div>


        <!-- CATEGORIES TAB -->
        <div id="categoriesTab" class="tab-page">
            <h1>Categories</h1>

            <h3>Default Categories</h3>
            <div id="globalCategoryList"></div>

            <h3 style="margin-top:1rem;">My Categories</h3>
            <div id="userCategoryList"></div>

            <div style="margin-top:1rem; display:flex; gap:0.5rem;">
                <input id="newCategoryName" 
                       type="text" 
                       placeholder="Add a category..." 
                       style="flex:1;">
                <button class="primary" onclick="addUserCategory()">Add</button>
            </div>
        </div>

        <!-- STORES TAB -->
        <div id="storesTab" class="tab-page">
            <h1>Stores</h1>

            <h3>Default Stores (Global)</h3>
            <div id="globalStoresList"></div>

            <h3 style="margin-top:1rem;">My Stores</h3>
            <div id="userStoresList"></div>

            <div style="margin-top:1rem; display:flex; gap:0.5rem;">
                <input id="newStoreName" 
                       type="text" 
                       placeholder="Add a store..." 
                       style="flex:1;">
                <button class="primary" onclick="addUserStore()">Add</button>
            </div>
        </div>




    <!-- RECIPE MODAL -->
    <div id="recipeModal" class="modal hidden">

        <div class="modal-backdrop" onclick="closeRecipeModal()"></div>

        <div class="modal-content">

            <!-- HEADER -->
            <div class="modal-header">
                <h2 id="recipeModalTitle">Add Recipe</h2>
                <button class="modal-close" onclick="closeRecipeModal()">×</button>
            </div>

            <!-- STEP DOTS -->
            <div class="modal-steps">
                <span id="stepDot1" class="step-dot active"></span>
                <span id="stepDot2" class="step-dot"></span>
                <span id="stepDot3" class="step-dot"></span>
            </div>

            <!-- STEP 1 -->
            <div id="modalStep1" class="modal-step">
                <label>Meal Name:</label>
                <input id="modalRecipeName" type="text" placeholder="Ex: Chicken Alfredo">

                <label>Category:</label>
                <select id="modalRecipeCategory"></select>

                <div class="modal-actions">
                    <button onclick="closeRecipeModal()">Cancel</button>
                    <button class="primary" onclick="goToStep(2)">Next →</button>
                </div>
            </div>

            <!-- STEP 2 -->
            <div id="modalStep2" class="modal-step hidden">
                <h3>Ingredients</h3>
                <p class="small-note">
                    Add all ingredients with store + unit + substitutes.
                </p>

                <div id="ingredientsContainer"></div>

                <button class="primary" onclick="addIngredientRow()">+ Add Ingredient</button>

                <div class="modal-actions">
                    <button onclick="goToStep(1)">← Back</button>
                    <button class="primary" onclick="goToStep(3)">Next →</button>
                </div>
            </div>

            <!-- STEP 3 -->
            <div id="modalStep3" class="modal-step hidden">
                <h3>Review Recipe</h3>

                <div class="review-block">
                    <strong>Name:</strong> <span id="reviewName"></span><br>
                    <strong>Category:</strong> <span id="reviewCategory"></span>
                </div>

                <div class="review-block">
                    <strong>Ingredients:</strong>
                    <ul id="reviewIngredients"></ul>
                </div>

                <div class="modal-actions">
                    <button onclick="goToStep(2)">← Back</button>
                    <button class="primary" onclick="saveRecipe()">Save Recipe</button>
                </div>
            </div>

        </div>
    </div>
<!-- SUBSTITUTE MODAL -->
<div id="subModal" class="modal hidden">
    <div class="modal-backdrop" onclick="closeSubstituteModal()"></div>

    <div class="modal-content" style="max-width: 450px;">
        <div class="modal-header">
            <h2>Choose Substitute</h2>
            <button class="modal-close" onclick="closeSubstituteModal()">×</button>
        </div>

        <div id="subModalBody" style="padding: 1rem 0;">
            <!-- Options injected dynamically -->
        </div>

        <div class="modal-actions" style="margin-top:1rem;">
            <button onclick="closeSubstituteModal()">Cancel</button>
            <button class="primary" onclick="applySubstituteChoice()">Use Selected</button>
        </div>
    </div>
</div>
    <script>
      const version = Date.now(); // forces fresh load every page visit
      document.write(`<script src="script.js?v=${version}" defer><\/script>`);
    </script>

    <script src="script.js?v=phase3c" defer></script>

</body>
</html>

